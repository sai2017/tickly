<div class="matchingPage">
  <header class="header">
    <i class="fas fa-comments fa-3x"></i>
  </header>
  <div class="container">
    <div class="mt-5">
      <div class="matchingNum"><%= @match_users.size %>人とマッチングしています</div>
      <h2 class="pageTitle">マッチングした人一覧</h2>
      <div class="matchingList">
        <% @match_users.each do |user| %>
          <div class="matchingPerson">
            <div class="matchingPerson_name"><%= user.name %></div>
            <% current_user_message_rooms = MessageRoomUser.where(user_id: current_user.id).map(&:message_room) %>
            <% message_room = MessageRoomUser.where(message_room: current_user_message_rooms, user_id: user.id).map(&:message_room).first %>
            <% if message_room.present? && message_room.messages.present? %>
              <%= Message.where(message_room_id: message_room.id).last.content %>
              <%= l Message.where(message_room_id: message_room.id).last.created_at, format: :short %>
            <% end %>
            <%= form_tag :messages, method: :post do %>
              <input name="user_id" type="hidden" value="<%= user.id %>" />
              <%= submit_tag 'チャットを開く', class: "chatForm_btn" %>
            <% end %>
          </div>
        <% end %>
      </div>
    <div>
  </div>
</div>